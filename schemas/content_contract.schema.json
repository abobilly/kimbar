{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "content_contract.schema.json",
  "title": "Content Contract",
  "description": "Machine-readable rules for Kim Bar content pipeline",
  "type": "object",
  "required": ["version", "tiles", "characters", "naming", "tags", "agentBoundaries"],
  "properties": {
    "$schema": { "type": "string" },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "tiles": {
      "type": "object",
      "required": ["tileSize"],
      "properties": {
        "tileSize": { "type": "integer", "minimum": 8 },
        "allowedTilesetWidths": { "type": "array", "items": { "type": "integer" } },
        "allowedTilesetHeights": { "type": "array", "items": { "type": "integer" } }
      }
    },
    "characters": {
      "type": "object",
      "required": ["frameWidth", "frameHeight", "directions", "requiredAnimations"],
      "properties": {
        "frameWidth": { "type": "integer", "minimum": 16 },
        "frameHeight": { "type": "integer", "minimum": 16 },
        "directions": {
          "type": "array",
          "items": { "type": "string", "enum": ["down", "left", "right", "up"] },
          "minItems": 4,
          "maxItems": 4
        },
        "requiredAnimations": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 1
        },
        "allowedFrameCounts": {
          "type": "object",
          "additionalProperties": { "type": "integer", "minimum": 1 }
        },
        "anchor": {
          "type": "string",
          "enum": ["bottomCenter", "center", "topLeft"]
        }
      }
    },
    "compositing": {
      "type": "object",
      "properties": {
        "layerOrder": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "naming": {
      "type": "object",
      "required": ["patterns"],
      "properties": {
        "patterns": {
          "type": "object",
          "additionalProperties": { "type": "string" }
        },
        "fileNaming": { "type": "string", "enum": ["snake_case", "kebab-case", "camelCase"] },
        "tagFormat": { "type": "string", "enum": ["snake_case", "kebab-case", "camelCase"] }
      }
    },
    "tags": {
      "type": "object",
      "required": ["subjects"],
      "properties": {
        "subjects": {
          "type": "array",
          "items": { "type": "string" },
          "minItems": 1
        },
        "topicTags": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "agentBoundaries": {
      "type": "object",
      "required": ["editable", "forbidden"],
      "properties": {
        "editable": {
          "type": "array",
          "items": { "type": "string" }
        },
        "forbidden": {
          "type": "array",
          "items": { "type": "string" }
        },
        "requireValidation": {
          "type": "array",
          "items": { "type": "string" }
        }
      }
    },
    "ldtk": {
      "type": "object",
      "properties": {
        "requiredEntityFields": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": { "type": "string" }
          }
        },
        "optionalEntityFields": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": { "type": "string" }
          }
        }
      }
    },
    "policySkips": {
      "type": "object",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "skipIdPrefixes": {
            "type": "array",
            "items": { "type": "string" }
          },
          "reason": { "type": "string" }
        }
      }
    }
  }
}
