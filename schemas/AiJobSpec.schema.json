{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://kimbar.badgey.org/schemas/AiJobSpec.schema.json",
  "title": "AI Job Specification",
  "description": "Defines a batch of assets to generate via ComfyUI",
  "type": "object",
  "required": ["setId", "workflow", "items"],
  "properties": {
    "$schema": {
      "type": "string"
    },
    "setId": {
      "type": "string",
      "pattern": "^[a-z][a-z0-9_]*\\.[a-z][a-z0-9_]*$",
      "description": "Unique identifier for this job set (e.g., 'props.courtroom_v1')"
    },
    "workflow": {
      "type": "string",
      "pattern": "^wf_[a-z0-9_]+$",
      "description": "ComfyUI workflow template ID (e.g., 'wf_prop_pixelize_v1')"
    },
    "defaults": {
      "type": "object",
      "description": "Default values applied to all items in this set",
      "properties": {
        "style": {
          "type": "string",
          "description": "Style suffix appended to all prompts"
        },
        "negativePrompt": {
          "type": "string",
          "description": "Negative prompt for all items"
        },
        "size": {
          "type": "integer",
          "enum": [32, 64, 128, 256, 512],
          "description": "Output size in pixels (square)"
        },
        "paletteColors": {
          "type": "integer",
          "minimum": 2,
          "maximum": 256,
          "description": "Number of colors in quantized palette"
        },
        "anchor": {
          "type": "array",
          "items": { "type": "number", "minimum": 0, "maximum": 1 },
          "minItems": 2,
          "maxItems": 2,
          "description": "Sprite anchor point [x, y] normalized 0-1"
        },
        "checkpoint": {
          "type": "string",
          "description": "Model checkpoint to use (default: workflow default)"
        }
      }
    },
    "items": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["id", "prompt"],
        "properties": {
          "id": {
            "type": "string",
          "pattern": "^(prop|tile|portrait|icon)\\.[a-z0-9_]+(\\.[a-z0-9_]+)*$",
          "description": "Asset ID matching content_contract naming pattern (dot namespaces allowed)"
          },
          "prompt": {
            "type": "string",
            "minLength": 10,
            "description": "Generation prompt (style suffix from defaults is appended)"
          },
          "negativePrompt": {
            "type": "string",
            "description": "Item-specific negative prompt (overrides default)"
          },
          "seed": {
            "type": "integer",
            "minimum": 0,
            "description": "Fixed seed for reproducibility (random if omitted)"
          },
          "size": {
            "type": "integer",
            "enum": [32, 64, 128, 256, 512],
            "description": "Item-specific output size (overrides default)"
          },
          "anchor": {
            "type": "array",
            "items": { "type": "number", "minimum": 0, "maximum": 1 },
            "minItems": 2,
            "maxItems": 2,
            "description": "Item-specific anchor (overrides default)"
          },
          "tags": {
            "type": "array",
            "items": { "type": "string", "pattern": "^[a-z][a-z0-9_]*$" },
            "description": "Tags for categorization and filtering"
          },
          "skip": {
            "type": "boolean",
            "description": "If true, skip this item during generation"
          }
        }
      }
    }
  }
}
